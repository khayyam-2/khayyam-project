<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced GPA/CGPA Calculator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --info-color: #17a2b8;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --light-bg: #f8f9fa;
            --dark-text: #2c3e50;
        }

        body {
            background-color: var(--light-bg);
            font-family: 'Inter', sans-serif;
            color: var(--dark-text);
        }

        .calculator-box {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin: 1.5rem 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .calculator-box:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: var(--primary-color);
            font-weight: 700;
            margin: 2rem 0;
            text-align: center;
        }

        h3 {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--primary-color);
        }

        .btn {
            font-weight: 500;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            transition: all 0.2s ease;
        }

        .form-control, .form-select {
            border-radius: 8px;
            padding: 0.75rem 1rem;
            border: 1px solid #dee2e6;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(74, 144, 226, 0.25);
        }

        .grade-table {
            overflow-x: auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .table {
            min-width: 800px;
            margin-bottom: 0;
        }

        .table th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
        }

        .alert {
            border-radius: 8px;
            border: none;
        }

        .points-column {
            background-color: rgba(74, 144, 226, 0.1);
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .calculator-box {
                padding: 1.5rem;
                margin: 1rem 0;
            }

            h1 {
                font-size: 2rem;
                margin: 1.5rem 0;
            }

            h3 {
                font-size: 1.5rem;
            }

            .btn {
                width: 100%;
                margin-bottom: 0.5rem;
            }

            .row.g-2 [class^="col-"] {
                margin-bottom: 0.5rem;
            }

            .grade-table {
                border-radius: 8px;
            }
        }

        @media (max-width: 576px) {
            .calculator-box {
                padding: 1rem;
            }

            h1 {
                font-size: 1.75rem;
            }

            h3 {
                font-size: 1.3rem;
            }

            .form-control, .form-select {
                padding: 0.6rem 0.8rem;
            }
        }

        .input-group-text {
            background-color: rgba(74, 144, 226, 0.1);
            border-color: #dee2e6;
            color: var(--dark-text);
        }

        .result-card {
            background: linear-gradient(135deg, rgba(74, 144, 226, 0.1), rgba(74, 144, 226, 0.05));
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1.5rem;
        }

        .floating-button-group {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            display: flex;
            gap: 0.5rem;
            z-index: 1000;
        }

        @media (min-width: 768px) {
            .floating-button-group {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Advanced GPA/CGPA Calculator</h1>

        <!-- GPA Calculator -->
        <div class="calculator-box">
            <h3>GPA Calculator</h3>
            <div id="subjectContainer">
                <!-- Subject rows will be added here -->
            </div>
            <div class="d-flex flex-column flex-md-row gap-2 justify-content-end mt-3">
                <button class="btn btn-success" onclick="addSubject()">Add Subject</button>
                <button class="btn btn-primary" onclick="calculateGPA()">Calculate GPA</button>
                <div class="btn-group">
                    <button class="btn btn-warning dropdown-toggle" data-bs-toggle="dropdown">Export</button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#" onclick="exportGPAReport('pdf')">PDF</a></li>
                        <li><a class="dropdown-item" href="#" onclick="exportGPAReport('excel')">Excel</a></li>
                    </ul>
                </div>
            </div>
            <div id="gpaResult" class="mt-3"></div>
        </div>

        <!-- CGPA Calculator -->
        <div class="calculator-box">
            <h3>CGPA Calculator</h3>
            <div id="semesterContainer">
                <!-- Semester rows will be added here -->
            </div>
            <div class="d-flex flex-column flex-md-row gap-2 justify-content-end mt-3">
                <button class="btn btn-success" onclick="addSemester()">Add Semester</button>
                <button class="btn btn-primary" onclick="calculateCGPA()">Calculate CGPA</button>
                <div class="btn-group">
                    <button class="btn btn-warning dropdown-toggle" data-bs-toggle="dropdown">Export</button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#" onclick="exportCGPAReport('pdf')">PDF</a></li>
                        <li><a class="dropdown-item" href="#" onclick="exportCGPAReport('excel')">Excel</a></li>
                    </ul>
                </div>
            </div>
            <div id="cgpaResult" class="mt-3"></div>
        </div>

        <!-- Grade Points Table -->
        <div class="calculator-box grade-table">
            <h3>Grade Points Reference</h3>
            <div id="gradeTable"></div>
        </div>
    </div>

    <!-- Mobile Floating Buttons -->
    <div class="floating-button-group">
        <button class="btn btn-primary btn-lg rounded-circle shadow" onclick="addSubject()">＋</button>
        <button class="btn btn-success btn-lg rounded-circle shadow" onclick="addSemester()">＋</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Grade point conversion data
        const gradePoints = {
            5: {
                40: 5.00, 41: 5.50, 42: 6.00, 43: 6.50, 44: 7.00, 45: 7.50, 46: 8.00,
                47: 8.50, 48: 9.00, 49: 9.50, 50: 10.00, 51: 10.50, 52: 10.50, 53: 11.00,
                54: 11.50, 55: 11.50, 56: 12.00, 57: 12.50, 58: 12.50, 59: 13.00, 60: 13.50,
                61: 13.50, 62: 14.00, 63: 14.50, 64: 14.50, 65: 15.00, 66: 15.50, 67: 15.50,
                68: 16.00, 69: 16.50, 70: 16.50, 71: 17.00, 72: 17.50, 73: 17.50, 74: 18.00,
                75: 18.50, 76: 18.50, 77: 19.00, 78: 19.50, 79: 19.50, 80: 20.00
            },
            4: {
                32: 4.00, 33: 4.40, 34: 5.20, 35: 5.60, 36: 6.00, 37: 6.40, 38: 7.20,
                39: 7.60, 40: 8.00, 41: 8.40, 42: 8.80, 43: 8.80, 44: 9.20, 45: 9.60,
                46: 10.00, 47: 10.40, 48: 10.80, 49: 10.80, 50: 11.20, 51: 11.60, 52: 12.00,
                53: 12.00, 54: 12.40, 55: 12.80, 56: 13.20, 57: 13.60, 58: 14.00, 59: 14.40,
                60: 14.80, 61: 14.80, 62: 15.20, 63: 15.60, 64: 16.00
            },
            3: {
                24: 3.00, 25: 3.60, 26: 3.90, 27: 4.50, 28: 5.10, 29: 5.40, 30: 6.00,
                31: 6.30, 32: 6.60, 33: 6.90, 34: 7.20, 35: 7.50, 36: 8.10, 37: 8.40,
                38: 8.70, 39: 9.00, 40: 9.30, 41: 9.60, 42: 9.90, 43: 10.20, 44: 10.50,
                45: 11.10, 46: 11.40, 47: 11.70, 48: 12.00
            },
            2: {
                16: 2.00, 17: 2.60, 18: 3.00, 19: 3.60, 20: 4.00, 21: 4.40, 22: 4.60,
                23: 5.00, 24: 5.40, 25: 5.60, 26: 6.00, 27: 6.40, 28: 6.60, 29: 7.00,
                30: 7.40, 31: 7.60, 32: 8.00
            }
        };

        // GPA Calculator Functions
        function addSubject() {
            const container = document.getElementById('subjectContainer');
            const newSubject = document.createElement('div');
            newSubject.className = 'row g-2 mb-2';
            newSubject.innerHTML = `
                <div class="col-md-3">
                    <input type="text" class="form-control subject-name" placeholder="Subject Name">
                </div>
                <div class="col-md-2">
                    <input type="number" class="form-control marks" placeholder="Marks" min="0" max="100" 
                           oninput="updatePoints(this)">
                </div>
                <div class="col-md-2">
                    <select class="form-select credit" onchange="updatePoints(this)">
                        <option value="5">5 Credits</option>
                        <option value="4">4 Credits</option>
                        <option value="3">3 Credits</option>
                        <option value="2">2 Credits</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <input type="number" class="form-control points-column" placeholder="Points" readonly>
                </div>
                <div class="col-md-3">
                    <button class="btn btn-danger w-100" onclick="removeSubject(this)">Remove</button>
                </div>
            `;
            container.appendChild(newSubject);
        }

        function updatePoints(element) {
            const row = element.closest('.row');
            const marksInput = row.querySelector('.marks');
            const creditSelect = row.querySelector('.credit');
            const pointsField = row.querySelector('.points-column');
            
            const marks = parseFloat(marksInput.value);
            const credit = parseInt(creditSelect.value);
            
            if (!isNaN(marks)) {
                const points = getGradePoint(marks, credit);
                pointsField.value = points.toFixed(2);
            } else {
                pointsField.value = '';
            }
        }

        function getGradePoint(marks, credit) {
            const creditTable = gradePoints[credit];
            if (!creditTable) return 0;
            
            const roundedMarks = Math.floor(marks);
            for (let s = roundedMarks; s >= 0; s--) {
                if (creditTable[s] !== undefined) {
                    return creditTable[s];
                }
            }
            return 0;
        }

        function calculateGPA() {
            const inputs = document.querySelectorAll('#subjectContainer .row.g-2.mb-2');
            let totalPoints = 0;
            let totalCredits = 0;

            inputs.forEach(input => {
                const credit = parseInt(input.querySelector('.credit')?.value) || 0;
                const pointsStr = input.querySelector('.points-column')?.value || "0";
                const points = parseFloat(pointsStr);
                
                if (!isNaN(points)) {
                    totalPoints += points;
                    totalCredits += credit;
                }
            });

            const gpa = totalCredits > 0 ? (totalPoints / totalCredits).toFixed(2) : 0;
            document.getElementById('gpaResult').innerHTML = `
                <div class="alert alert-success">
                    <h4>GPA: ${gpa}</h4>
                    <p>Total Credits: ${totalCredits}</p>
                    <p>Total Points: ${totalPoints.toFixed(2)}</p>
                    <p>Formula: Sum of all points (${totalPoints.toFixed(2)}) / Total subject credits (${totalCredits})</p>
                </div>
            `;
            
            return {
                gpa: gpa,
                totalCredits: totalCredits,
                totalPoints: totalPoints
            };
        }

        function removeSubject(btn) {
            const container = btn.closest('.row');
            if (document.querySelectorAll('#subjectContainer .row.g-2.mb-2').length > 1) {
                container.remove();
            }
        }

        // CGPA Calculator Functions
        function addSemester() {
            const container = document.getElementById('semesterContainer');
            const newSemester = document.createElement('div');
            newSemester.className = 'row g-2 mb-2';
            newSemester.innerHTML = `
                <div class="col-md-4">
                    <input type="text" class="form-control semester-name" placeholder="Semester Name (e.g. Fall 2024)">
                </div>
                <div class="col-md-4">
                    <input type="number" step="0.01" class="form-control semester-gpa" 
                           placeholder="Semester GPA" min="0" max="4.00">
                </div>
                <div class="col-md-4">
                    <button class="btn btn-danger w-100" onclick="removeSemester(this)">Remove</button>
                </div>
            `;
            container.appendChild(newSemester);
        }

        function calculateCGPA() {
            const inputs = document.querySelectorAll('#semesterContainer .semester-gpa');
            let total = 0;
            let validSemesters = 0;

            inputs.forEach(input => {
                const gpa = parseFloat(input.value);
                if (!isNaN(gpa) && gpa <= 4.00) {
                    total += gpa;
                    validSemesters++;
                }
            });

            const cgpa = validSemesters > 0 ? (total / validSemesters).toFixed(2) : 0;
            document.getElementById('cgpaResult').innerHTML = `
                <div class="alert alert-info">
                    <h4>CGPA: ${cgpa}</h4>
                    <p>Semesters Calculated: ${validSemesters}</p>
                    <p>Formula: Sum of all semester GPAs (${total.toFixed(2)}) / Number of semesters (${validSemesters})</p>
                </div>
            `;
            
            return {
                cgpa: cgpa,
                semestersCalculated: validSemesters,
                totalGPA: total
            };
        }

        function removeSemester(btn) {
            const container = btn.closest('.row');
            if (document.querySelectorAll('#semesterContainer .row.g-2.mb-2').length > 1) {
                container.remove();
            }
        }

        // Export Functions
        function exportGPAReport(type) {
            const inputs = document.querySelectorAll('#subjectContainer .row.g-2.mb-2');
            const reportData = [];
            
            inputs.forEach((input, index) => {
                const subjectName = input.querySelector('.subject-name').value || `Subject ${index + 1}`;
                const marks = input.querySelector('.marks').value;
                const credit = input.querySelector('.credit').value;
                const points = input.querySelector('.points-column').value;
                
                reportData.push({
                    Subject: subjectName,
                    Marks: marks ? marks : '-',
                    Credit: credit,
                    Points: points ? points : '-'
                });
            });
            
            // Get calculation results
            const results = calculateGPA();

            if (type === 'pdf') {
                // Create PDF with jsPDF
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Add logo and header
                doc.setFontSize(22);
                doc.setTextColor(58, 90, 120); // #3a5a78
                doc.text("GPA Report", doc.internal.pageSize.width / 2, 20, { align: 'center' });
                
                // Add date
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                const currentDate = new Date().toLocaleDateString();
                doc.text(`Generated on: ${currentDate}`, doc.internal.pageSize.width - 30, 30, { align: 'right' });
                
                // Add subject data table
                doc.autoTable({
                    startY: 40,
                    head: [['Subject', 'Marks', 'Credit', 'Points']],
                    body: reportData.map(item => [item.Subject, item.Marks, item.Credit, item.Points]),
                    theme: 'grid',
                    headStyles: { 
                        fillColor: [58, 90, 120],
                        textColor: [255, 255, 255],
                        fontStyle: 'bold'
                    },
                    alternateRowStyles: {
                        fillColor: [240, 240, 240]
                    },
                    margin: { top: 40 }
                });
                
                // Add summary box
                const finalY = doc.lastAutoTable.finalY + 10;
                doc.setFillColor(209, 231, 221); // light green
                doc.roundedRect(14, finalY, 182, 40, 3, 3, 'F');
                
                // Add summary text
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(16);
                doc.text(`Final GPA: ${results.gpa}`, 20, finalY + 15);
                
                doc.setFontSize(12);
                doc.text(`Total Credits: ${results.totalCredits}`, 20, finalY + 25);
                doc.text(`Total Points: ${results.totalPoints.toFixed(2)}`, 20, finalY + 35);
                
                // Add footer
                doc.setFontSize(10);
                doc.setTextColor(150, 150, 150);
                doc.text("Advanced GPA/CGPA Calculator", doc.internal.pageSize.width / 2, doc.internal.pageSize.height - 10, { align: 'center' });
                
                // Save the PDF
                doc.save('gpa-report.pdf');
            } else {
                // Add summary to the last rows
                reportData.push({ Subject: '', Marks: '', Credit: '', Points: '' });
                reportData.push({ Subject: 'Summary', Marks: '', Credit: '', Points: '' });
                reportData.push({ Subject: `GPA: ${results.gpa}`, Marks: '', Credit: '', Points: '' });
                reportData.push({ Subject: `Total Credits: ${results.totalCredits}`, Marks: '', Credit: '', Points: '' });
                reportData.push({ Subject: `Total Points: ${results.totalPoints.toFixed(2)}`, Marks: '', Credit: '', Points: '' });
                
                // Export to Excel
                const ws = XLSX.utils.json_to_sheet(reportData);
                
                // Set column widths
                const wscols = [
                    { wch: 25 }, // Subject
                    { wch: 15 }, // Marks
                    { wch: 15 }, // Credit
                    { wch: 15 }, // Points
                ];
                ws['!cols'] = wscols;
                
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "GPA Report");
                XLSX.writeFile(wb, 'gpa-report.xlsx');
            }
        }

        function exportCGPAReport(type) {
            const inputs = document.querySelectorAll('#semesterContainer .row.g-2.mb-2');
            const reportData = [];
            
            inputs.forEach((input, index) => {
                const semesterName = input.querySelector('.semester-name').value || `Semester ${index + 1}`;
                const gpa = input.querySelector('.semester-gpa').value;
                
                reportData.push({
                    Semester: semesterName,
                    GPA: gpa ? gpa : '-'
                });
            });
            
            // Get calculation results
            const results = calculateCGPA();

            if (type === 'pdf') {
                // Create PDF with jsPDF
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Add logo and header
                doc.setFontSize(22);
                doc.setTextColor(58, 90, 120); // #3a5a78
                doc.text("CGPA Report", doc.internal.pageSize.width / 2, 20, { align: 'center' });
                
                // Add date
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                const currentDate = new Date().toLocaleDateString();
                doc.text(`Generated on: ${currentDate}`, doc.internal.pageSize.width - 30, 30, { align: 'right' });
                
                // Add semester data table
                doc.autoTable({
                    startY: 40,
                    head: [['Semester', 'GPA']],
                    body: reportData.map(item => [item.Semester, item.GPA]),
                    theme: 'grid',
                    headStyles: { 
                        fillColor: [72, 133, 237], // blue
                        textColor: [255, 255, 255],
                        fontStyle: 'bold'
                    },
                    alternateRowStyles: {
                        fillColor: [240, 240, 240]
                    },
                    margin: { top: 40 }
                });
                
                // Add summary box
                const finalY = doc.lastAutoTable.finalY + 10;
                doc.setFillColor(207, 226, 255); // light blue
                doc.roundedRect(14, finalY, 182, 30, 3, 3, 'F');
                
                // Add summary text
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(16);
                doc.text(`Final CGPA: ${results.cgpa}`, 20, finalY + 15);
                
                doc.setFontSize(12);
                doc.text(`Semesters Calculated: ${results.semestersCalculated}`, 20, finalY + 25);
                
                // Add footer
                doc.setFontSize(10);
                doc.setTextColor(150, 150, 150);
                doc.text("Advanced GPA/CGPA Calculator", doc.internal.pageSize.width / 2, doc.internal.pageSize.height - 10, { align: 'center' });
                
                // Save the PDF
                doc.save('cgpa-report.pdf');
            } else {
                // Add summary to the last rows
                reportData.push({ Semester: '', GPA: '' });
                reportData.push({ Semester: 'Summary', GPA: '' });
                reportData.push({ Semester: `CGPA: ${results.cgpa}`, GPA: '' });
                reportData.push({ Semester: `Semesters Calculated: ${results.semestersCalculated}`, GPA: '' });
                
                // Export to Excel
                const ws = XLSX.utils.json_to_sheet(reportData);
                
                // Set column widths
                const wscols = [
                    { wch: 25 }, // Semester
                    { wch: 15 }, // GPA
                ];
                ws['!cols'] = wscols;
                
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "CGPA Report");
                XLSX.writeFile(wb, 'cgpa-report.xlsx');
            }
        }

        // Initialize Grade Table
        function initGradeTable() {
            const table = document.createElement('table');
            table.className = 'table table-bordered table-striped';
            
            let headerRow = `<thead class="table-header">
                                <tr>
                                    <th>Score</th>
                                    <th>5 Credits</th>
                                    <th>4 Credits</th>
                                    <th>3 Credits</th>
                                    <th>2 Credits</th>
                                </tr>
                            </thead>`;
            
            let tableBody = '<tbody>';
            
            // Generate table rows
            for (let score = 16; score <= 80; score++) {
                let row = `<tr><td>${score}</td>`;
                
                // 5 Credit column
                if (gradePoints[5] && gradePoints[5][score] !== undefined) {
                    row += `<td>${gradePoints[5][score].toFixed(2)}</td>`;
                } else {
                    row += `<td>-</td>`;
                }
                
                // 4 Credit column
                if (gradePoints[4] && gradePoints[4][score] !== undefined) {
                    row += `<td>${gradePoints[4][score].toFixed(2)}</td>`;
                } else {
                    row += `<td>-</td>`;
                }
                
                // 3 Credit column
                if (gradePoints[3] && gradePoints[3][score] !== undefined) {
                    row += `<td>${gradePoints[3][score].toFixed(2)}</td>`;
                } else {
                    row += `<td>-</td>`;
                }
                
                // 2 Credit column
                if (gradePoints[2] && gradePoints[2][score] !== undefined) {
                    row += `<td>${gradePoints[2][score].toFixed(2)}</td>`;
                } else {
                    row += `<td>-</td>`;
                }
                
                row += '</tr>';
                tableBody += row;
            }
            
            tableBody += '</tbody>';
            table.innerHTML = headerRow + tableBody;
            
            document.getElementById('gradeTable').appendChild(table);
        }

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            // Add initial subject and semester
            addSubject();
            addSemester();
            // Initialize grade table
            initGradeTable();
        });
    </script>
</body>
</html>